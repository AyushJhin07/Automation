{
  "id": "slack-send-message",
  "description": "Sends a Slack notification with chat.postMessage using the Apps Script OAuth helper.",
  "graph": {
    "id": "fixture-slack-send-message",
    "name": "Slack send message",
    "nodes": [
      {
        "id": "slack-action",
        "type": "action.slack",
        "app": "slack",
        "name": "Notify incident channel",
        "op": "action.slack:send_message",
        "params": {
          "operation": "send_message",
          "channel": "#incidents",
          "text": "Critical incident declared",
          "username": "Automation Bot",
          "icon_emoji": ":robot_face:"
        },
        "data": {
          "operation": "send_message",
          "config": {
            "channel": "#incidents",
            "text": "Critical incident declared",
            "username": "Automation Bot",
            "icon_emoji": ":robot_face:"
          }
        }
      }
    ],
    "edges": []
  },
  "entry": {
    "context": {
      "incidentId": "INC-1001"
    }
  },
  "secrets": {
    "SLACK_BOT_TOKEN": "xoxb-test-token"
  },
  "http": [
    {
      "name": "slack-chat-post",
      "request": {
        "url": "https://slack.com/api/chat.postMessage",
        "method": "POST",
        "headers": {
          "authorization": "Bearer xoxb-test-token",
          "content-type": "application/json"
        },
        "payload": {
          "channel": "#incidents",
          "text": "Critical incident declared",
          "username": "Automation Bot",
          "icon_emoji": ":robot_face:"
        }
      },
      "response": {
        "status": 200,
        "body": {
          "ok": true,
          "channel": "C123",
          "ts": "1733756457.000200",
          "message": {
            "type": "message",
            "text": "Critical incident declared",
            "user": "U123",
            "ts": "1733756457.000200"
          }
        }
      }
    }
  ],
  "expect": {
    "context": {
      "incidentId": "INC-1001",
      "slackSent": true,
      "slackChannel": "C123",
      "slackMessageTs": "1733756457.000200",
      "slackMessage": {
        "type": "message",
        "text": "Critical incident declared",
        "user": "U123",
        "ts": "1733756457.000200"
      }
    },
    "logs": [
      {
        "level": "log",
        "includes": "slack_send_message_success"
      }
    ],
    "httpCalls": [
      {
        "url": "https://slack.com/api/chat.postMessage",
        "method": "POST"
      }
    ]
  }
}
