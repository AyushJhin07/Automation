{
  "id": "apps-script-tier-2-long-tail",
  "name": "Tier 2 async project orchestration",
  "meta": {
    "appsScript": {
      "tier": 2,
      "description": "Nightly schedule creates Asana tasks and falls back to Trello if APIs fail",
      "features": ["polling", "authentication", "retries", "error-handling"]
    },
    "automationType": "project_management",
    "prompt": "Every night create an Asana task for outstanding documents and backfill a Trello card if Asana fails"
  },
  "nodes": [
    {
      "id": "schedule-trigger",
      "type": "trigger.time",
      "app": "time",
      "name": "Nightly schedule",
      "op": "trigger.time:schedule",
      "params": {
        "frequency": "24",
        "unit": "hours"
      },
      "data": {
        "operation": "schedule",
        "config": {
          "frequency": "24",
          "unit": "hours"
        }
      }
    },
    {
      "id": "asana-task",
      "type": "action.asana",
      "app": "asana",
      "name": "Create documentation task",
      "op": "action.asana:create_task",
      "params": {
        "projectId": "123456789",
        "name": "Compile nightly document digest",
        "notes": "Generated by Apps Script nightly job"
      },
      "data": {
        "operation": "create_task",
        "config": {
          "projectId": "123456789",
          "name": "Compile nightly document digest",
          "notes": "Generated by Apps Script nightly job"
        }
      }
    },
    {
      "id": "task-check",
      "type": "condition.branch",
      "app": "system",
      "name": "Did Asana issue an ID?",
      "op": "condition.branch:asana_success",
      "params": {
        "rule": "!!ctx.asanaTaskId"
      },
      "data": {
        "operation": "asana_success",
        "config": {
          "rule": "!!ctx.asanaTaskId"
        }
      }
    },
    {
      "id": "cooldown-delay",
      "type": "action.time",
      "app": "time",
      "name": "Throttle API activity",
      "op": "action.time:delay",
      "params": {
        "hours": 1
      },
      "data": {
        "operation": "delay",
        "config": {
          "hours": 1
        }
      }
    },
    {
      "id": "mailchimp-fallback",
      "type": "action.mailchimp",
      "app": "mailchimp",
      "name": "Tag contact for manual follow-up",
      "op": "action.mailchimp:add_subscriber",
      "params": {
        "email": "{{input.email}}",
        "firstName": "{{input.first_name}}",
        "lastName": "{{input.last_name}}",
        "status": "pending"
      },
      "data": {
        "operation": "add_subscriber",
        "config": {
          "email": "{{input.email}}",
          "firstName": "{{input.first_name}}",
          "lastName": "{{input.last_name}}",
          "status": "pending"
        }
      }
    }
  ],
  "edges": [
    { "id": "edge-schedule-to-asana", "from": "schedule-trigger", "to": "asana-task", "source": "schedule-trigger", "target": "asana-task" },
    { "id": "edge-asana-to-condition", "from": "asana-task", "to": "task-check", "source": "asana-task", "target": "task-check" },
    { "id": "edge-condition-success", "from": "task-check", "to": "cooldown-delay", "source": "task-check", "target": "cooldown-delay", "branchValue": "true", "label": "cooldown" },
    { "id": "edge-condition-failure", "from": "task-check", "to": "mailchimp-fallback", "source": "task-check", "target": "mailchimp-fallback", "branchValue": "false", "label": "fallback" }
  ]
}
