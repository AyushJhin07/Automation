{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://apps-script-studio.com/schemas/graph.schema.json",
  "title": "NodeGraph",
  "description": "A directed acyclic graph representing a Google Apps Script automation workflow",
  "type": "object",
  "required": [
    "id",
    "name",
    "nodes",
    "edges",
    "metadata"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Unique identifier for the graph"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Human-readable name for the automation"
    },
    "description": {
      "type": "string",
      "maxLength": 500,
      "description": "Optional description of what this automation does"
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/Node"
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Edge"
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        },
        "author": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "version",
        "createdAt"
      ]
    }
  },
  "definitions": {
    "Node": {
      "type": "object",
      "required": [
        "id",
        "type",
        "position"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "type": {
          "type": "string",
          "enum": [
            "action.airtable.create_record",
            "action.airtable.delete_record",
            "action.airtable.list_records",
            "action.airtable.update_record",
            "action.dropbox.create_folder",
            "action.dropbox.download_file",
            "action.dropbox.list_files",
            "action.dropbox.share_file",
            "action.dropbox.upload_file",
            "action.github.add_comment",
            "action.github.create_issue",
            "action.github.create_pull_request",
            "action.gmail.add_label",
            "action.gmail.archive_email",
            "action.gmail.batch_modify",
            "action.gmail.create_draft",
            "action.gmail.create_label",
            "action.gmail.delete_email",
            "action.gmail.forward_email",
            "action.gmail.get_profile",
            "action.gmail.mark_as_read",
            "action.gmail.mark_as_unread",
            "action.gmail.modify_labels_batch",
            "action.gmail.remove_label",
            "action.gmail.reply_to_email",
            "action.gmail.search_emails",
            "action.gmail.send_draft",
            "action.gmail.send_email",
            "action.gmail.stop_watch",
            "action.gmail.watch_inbox",
            "action.http.request",
            "action.hubspot.create_company",
            "action.hubspot.create_contact",
            "action.hubspot.create_deal",
            "action.hubspot.create_task",
            "action.hubspot.create_ticket",
            "action.hubspot.delete_company",
            "action.hubspot.delete_contact",
            "action.hubspot.delete_deal",
            "action.hubspot.get_contact",
            "action.hubspot.search_contacts",
            "action.hubspot.send_email",
            "action.hubspot.update_company",
            "action.hubspot.update_contact",
            "action.hubspot.update_deal",
            "action.jira.add_attachment",
            "action.jira.add_comment",
            "action.jira.add_label",
            "action.jira.add_watcher",
            "action.jira.add_worklog",
            "action.jira.assign_issue",
            "action.jira.create_issue",
            "action.jira.create_project",
            "action.jira.create_subtask",
            "action.jira.link_issues",
            "action.jira.search_issues",
            "action.jira.transition_issue",
            "action.jira.update_issue",
            "action.mailchimp.add_subscriber",
            "action.mailchimp.create_campaign",
            "action.mailchimp.send_campaign",
            "action.mailchimp.update_subscriber",
            "action.notion.create_database_entry",
            "action.notion.create_page",
            "action.notion.query_database",
            "action.notion.update_page",
            "action.salesforce.create_lead",
            "action.salesforce.create_opportunity",
            "action.salesforce.create_task",
            "action.salesforce.update_contact",
            "action.sheets.append_row",
            "action.shopify.add_product_to_collection",
            "action.shopify.archive_product",
            "action.shopify.cancel_order",
            "action.shopify.complete_draft_order",
            "action.shopify.create_collection",
            "action.shopify.create_customer",
            "action.shopify.create_discount_code",
            "action.shopify.create_fulfillment_service",
            "action.shopify.create_order",
            "action.shopify.create_price_rule",
            "action.shopify.create_product",
            "action.shopify.delete_product",
            "action.shopify.fulfill_order",
            "action.shopify.get_products",
            "action.shopify.refund_order",
            "action.shopify.remove_product_from_collection",
            "action.shopify.search_customers",
            "action.shopify.unarchive_product",
            "action.shopify.update_customer",
            "action.shopify.update_inventory",
            "action.shopify.update_order",
            "action.shopify.update_product",
            "action.slack.add_reaction",
            "action.slack.archive_channel",
            "action.slack.create_channel",
            "action.slack.delete_message",
            "action.slack.list_channels",
            "action.slack.list_users",
            "action.slack.pin_message",
            "action.slack.remove_reaction",
            "action.slack.reply_in_thread",
            "action.slack.schedule_message",
            "action.slack.send_message",
            "action.slack.set_status",
            "action.slack.unpin_message",
            "action.slack.update_message",
            "action.slack.upload_file",
            "action.stripe.create_customer",
            "action.stripe.create_payment_intent",
            "action.stripe.create_refund",
            "action.stripe.create_subscription",
            "action.twilio.make_call",
            "action.twilio.send_sms",
            "action.twilio.send_whatsapp",
            "trigger.airtable.record_created",
            "trigger.airtable.record_updated",
            "trigger.dropbox.file_modified",
            "trigger.dropbox.file_uploaded",
            "trigger.github.issue_opened",
            "trigger.github.pull_request_opened",
            "trigger.gmail.attachment_received",
            "trigger.gmail.email_starred",
            "trigger.gmail.label_added",
            "trigger.gmail.new_email_received",
            "trigger.gmail.new_email_with_query",
            "trigger.gmail.thread_updated",
            "trigger.hubspot.company_created",
            "trigger.hubspot.company_updated",
            "trigger.hubspot.contact_updated",
            "trigger.hubspot.deal_created",
            "trigger.hubspot.deal_stage_changed",
            "trigger.hubspot.form_submission",
            "trigger.hubspot.new_contact",
            "trigger.hubspot.new_deal",
            "trigger.hubspot.ticket_created",
            "trigger.hubspot.ticket_updated",
            "trigger.jira.comment_added",
            "trigger.jira.issue_commented",
            "trigger.jira.issue_created",
            "trigger.jira.issue_deleted",
            "trigger.jira.issue_transitioned",
            "trigger.jira.issue_updated",
            "trigger.jira.sprint_started",
            "trigger.mailchimp.campaign_sent",
            "trigger.mailchimp.subscriber_added",
            "trigger.notion.database_entry_created",
            "trigger.notion.page_created",
            "trigger.salesforce.lead_created",
            "trigger.salesforce.opportunity_closed",
            "trigger.shopify.customer_created",
            "trigger.shopify.inventory_low",
            "trigger.shopify.order_cancelled",
            "trigger.shopify.order_created",
            "trigger.shopify.order_fulfilled",
            "trigger.shopify.order_paid",
            "trigger.shopify.product_created",
            "trigger.shopify.product_updated",
            "trigger.shopify.refund_created",
            "trigger.slack.channel_archived",
            "trigger.slack.file_uploaded",
            "trigger.slack.message_edited",
            "trigger.slack.new_channel",
            "trigger.slack.new_message",
            "trigger.slack.reaction_removed",
            "trigger.slack.user_joined",
            "trigger.slack.user_left",
            "trigger.stripe.payment_succeeded",
            "trigger.stripe.subscription_created",
            "trigger.time.cron",
            "trigger.twilio.call_completed",
            "trigger.twilio.message_received",
            "trigger.webhook.inbound"
          ]
        },
        "position": {
          "type": "object",
          "required": [
            "x",
            "y"
          ],
          "properties": {
            "x": {
              "type": "number"
            },
            "y": {
              "type": "number"
            }
          }
        },
        "data": {
          "type": "object",
          "description": "Node-specific configuration data"
        },
        "label": {
          "type": "string",
          "maxLength": 50
        }
      }
    },
    "Edge": {
      "type": "object",
      "required": [
        "id",
        "source",
        "target"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "source": {
          "type": "string",
          "description": "Source node ID"
        },
        "target": {
          "type": "string",
          "description": "Target node ID"
        },
        "sourceHandle": {
          "type": "string",
          "description": "Optional source handle ID"
        },
        "targetHandle": {
          "type": "string",
          "description": "Optional target handle ID"
        },
        "condition": {
          "type": "object",
          "description": "Optional condition for conditional edges"
        }
      }
    }
  }
}